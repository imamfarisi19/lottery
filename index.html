<!DOCTYPE html>
<html>

<head>
    <style>
        th,
        ol {
            border: 1px solid black;
            border-collapse: collapse;
            font-size: small;
        }
        
        ol {
            margin: auto;
            padding-left: auto;
        }
        
        li {
            transition-duration: 0.5ms;
        }
        
        li:hover {
            color: black;
            background-color: yellow;
        }
    </style>

    <title>Lottery Farisi</title>
</head>

<body>
    <h1> Aplikasi undian - Farisi </h1>
    <h2>File upload</h2>
    <label for="myfile">Select a file:</label><br/>
    <input type="file" id="fileUpload" name="fileUpload" required/><br/>
    <input type=" text " id="jumlahpemenang" name="jumlahpemenang" required/><br/>
    <input type="submit" value="Submit" onclick="upload()">
    <hr/>

    <table id="tableData" style="width: 100%">
        <tr>
            <th>Nama</th>
            <th>Email</th>
            <th>Nomor WhatsApp</th>
        </tr>
        <tr>
            <td>
                <ol id="name"></ol>
            </td>

            <td>
                <ol id="email"></ol>
            </td>

            <td>
                <ol id="wa"></ol>
            </td>
        </tr>
        <tr></tr>
        <tr></tr>
    </table>

    <script>
        function upload(event) {
            var file = document.getElementById("fileUpload").files[0];
            var reader = new FileReader();
            const limit = document.getElementById("jumlahpemenang").value;
            const comma = ',';

            reader.onload = function(e) {
                console.log(e)
                var ar = e.target.result.split("\n");
                ar.shift();
                let shuffleData = acak(ar);
                let rowData = shuffleData.splice(0, limit);

                rowData.map(row => {
                    const name = row.split(",")[2].split('"')[1];
                    const email = row.split(",")[1].split('"')[1];
                    const wa = row.split(",")[5].split('"')[1];

                    // Create list element from name
                    let nameListData = document.createElement("li");
                    let nameValueData = document.createTextNode(name);
                    nameListData.appendChild(nameValueData);
                    document.getElementById("name").appendChild(nameListData);

                    // Create list element from email
                    let emailListData = document.createElement("li");
                    let emailValueData = document.createTextNode(email);
                    emailListData.appendChild(emailValueData);
                    document.getElementById("email").appendChild(emailListData);

                    // Create list element from WhatsApp
                    let waListData = document.createElement("li");
                    let waValueData = document.createTextNode(wa);
                    waListData.appendChild(waValueData);
                    document.getElementById("wa").appendChild(waListData);
                })
            };
            reader.readAsText(file);
        }

        function acak(ar) {

            var ctr = ar.length,
                temp, index;

            // while there are elements in the array
            while (ctr > 0) {
                // pick a random index
                index = Math.floor(Math.random() * ctr);
                // Decrease ctr by 1
                ctr--;
                // and swap the last element with it
                temp = ar[ctr];
                ar[ctr] = ar[index];
                ar[index] = temp;
            }
            return ar;
        }
    </script>

</body>

</html>