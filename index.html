<!DOCTYPE html>
<html>

<head>
    <title>Lottery Farisi</title>
</head>

<body>
    <h1> Aplikasi undian - Farisi </h1>
    <h2>File upload</h2>
    <label for="myfile">Select a file:</label><br/>
    <input type="file" id="fileUpload" name="fileUpload" required/><br/>
    <input type=" text " id="jumlahpemenang" name="jumlahpemenang" required/><br/>
    <input type="submit" value="Submit" onclick="upload()">
    <hr/>
    <ol id="result"></ol>
    <table id="tableData" style="width: 100%">
        <tr>
            <th>TimeStamp</th>
            <th>Email</th>
            <th>Nama</th>
            <th>Asal Instansi</th>
            <th>Pekerjaan</th>
            <th>Nomor WhatsApp</th>
        </tr>
    </table>

    <h3 id="hasil1"></h3>
    <script>
        function itterationTable(data) {
            var tableContent = '<tr>';
            for (index = 0; index < hasil.length; index++) {
                tableContent += "<tr><td>" + hasil[index] + "</td></tr>";
            }
            output.innerHTML = tableContent;
        }

        function upload(event) {
            var file = document.getElementById("fileUpload").files[0];
            var reader = new FileReader();
            const limit = document.getElementById("jumlahpemenang").value;
            const comma = ',';

            reader.onload = function(e) {
                console.log(e)
                var ar = e.target.result.split("\n");
                ar.shift();
                let shuffleData = acak(ar);
                let rowData = shuffleData.splice(0, limit);

		    rowData.map(row =>{
			 const name = row.split(",")[2].split('"')[1];
			 // Create list element
			 let listData = document.createElement("li");
			 let valueData = document.createTextNode(name);
			 listData.appendChild(valueData);
			    
			document.getElementById("result").appendChild(listData);
		    })
            };
            reader.readAsText(file);
        }

        function validate_fileupload(fileName) {
            var allowed_extensions = new Array("csv");
            var file_extension = fileName.split('.').pop().toLowerCase(); // split function will split the filename by dot., and pop function will pop the last element from the array which will give you the extension as well. If there will be no extension then it will return the filename.
            for (var i = 0; i <= allowed_extensions.length; i++) {
                if (allowed_extensions[i] == file_extension) {
                    return true; // valid file extension
                }
            }
            return false;
        }

        function acak(ar) {

            var ctr = ar.length,
                temp, index;

            // while there are elements in the array
            while (ctr > 0) {
                // pick a random index
                index = Math.floor(Math.random() * ctr);
                // Decrease ctr by 1
                ctr--;
                // and swap the last element with it
                temp = ar[ctr];
                ar[ctr] = ar[index];
                ar[index] = temp;
            }
            return ar;
        }
    </script>

</body>

</html>
